{"version":3,"file":"KmDrafts.umd.js","sources":["../../../../src/services/api/api-base.js","../../../../src/services/api/km-storage/KmDrafts.js"],"sourcesContent":["import axios from 'axios'\r\nimport { isFunction } from 'lodash'\r\nimport * as Vue from 'vue'\r\n\r\nlet sitePrefixUrl = 'https://api.cbd.int';\r\n\r\nif(/\\.cbd\\.int$/i   .test(window?.location?.hostname || '')) sitePrefixUrl= 'https://api.cbd.int';\r\nif(/\\.cbddev\\.xyz$/i.test(window?.location?.hostname || '')) sitePrefixUrl= 'https://api.cbddev.xyz';\r\nif(/\\localhost$/i   .test(window?.location?.hostname || '')) sitePrefixUrl= '/';\r\n\r\nconst defaultOptions = { \r\n   prefixUrl:  sitePrefixUrl, \r\n   timeout  : 30 * 1000,\r\n   token: Vue?.prototype?.$auth?.strategy?.token?.get()  \r\n}\r\n\r\nexport default class ApiBase\r\n{\r\n  constructor(options) {\r\n    options = options || {};\r\n\r\n    if(isFunction(options)) options = { token : options }\r\n\r\n    const { token, prefixUrl, timeout, tokenType } = { ...defaultOptions, ...options }\r\n\r\n    this.config = {\r\n      baseURL : prefixUrl,\r\n      timeout,\r\n      tokenType,\r\n      token,\r\n    }\r\n\r\n    const http = async function (...args) {   \r\n      return (await loadAsyncHeaders(this.config))(...args);\r\n    }\r\n\r\n    http.get     = async (...args)=> (await loadAsyncHeaders(this.config)).get    (...args);\r\n    http.head    = async (...args)=> (await loadAsyncHeaders(this.config)).head   (...args);\r\n    http.post    = async (...args)=> (await loadAsyncHeaders(this.config)).post   (...args);\r\n    http.put     = async (...args)=> (await loadAsyncHeaders(this.config)).put    (...args);\r\n    http.patch   = async (...args)=> (await loadAsyncHeaders(this.config)).patch  (...args);\r\n    http.delete  = async (...args)=> (await loadAsyncHeaders(this.config)).delete (...args);\r\n    http.options = async (...args)=> (await loadAsyncHeaders(this.config)).options(...args);\r\n    http.request = async (...args)=> (await loadAsyncHeaders(this.config)).request(...args);\r\n\r\n    this.http = http;\r\n  }\r\n}\r\n\r\nasync function loadAsyncHeaders(baseConfig) {\r\n\r\n  const { token, tokenType, ...config } = baseConfig || {}\r\n\r\n  const headers = { ...(config.headers || {}) };\r\n\r\n  if(token) {\r\n      headers.Authorization = `${tokenType||'Bearer'} ${token}`;\r\n  }\r\n\r\n  return axios.create({ ...config, headers } );\r\n\r\n}\r\n\r\n//////////////////////////\r\n// Helpers\r\n////////////////////////\r\n\r\nexport function tryCastToApiError(error) {\r\n\r\n  if(error && error.response && error.response.data && error.response.data.code) {\r\n      const apiError = error.response.data\r\n      throw error.response.data;\r\n  }\r\n\r\n  throw error\r\n}\r\n\r\nexport function stringifyUrlParam(value) {\r\n  if (value instanceof(Date))   {return value.toISOString()}    \r\n  if (value instanceof(Object)) {return JSON.stringify(value)}  \r\n  return value; \r\n}\r\n\r\nexport function stringifyUrlParams(valueObj) {\r\n  const returnObj = {};\r\n\r\n  for (const [key, value] of Object.entries(valueObj)) {\r\n    if (isValid(value)){\r\n      returnObj[key] = stringifyUrlParam(value);\r\n    }\r\n  }\r\n  \r\n  return returnObj;\r\n}\r\n\r\nexport function mapObjectId(id){  \r\n  return isObjectId(id)? { $oid: id } : id\r\n}\r\n\r\nexport function isObjectId(id){\r\n  return /^[a-f0-9]{24}/i.test(id);\r\n}\r\n\r\nexport function isValid(params){\r\n  return ![undefined, null].includes(params);\r\n}","import ApiBase, { tryCastToApiError, isValid, stringifyUrlParams } from '../api-base';\r\n\r\nconst  serviceUrls = { \r\n  documentQueryUrl      (                     ){ return \"/api/v2013/documents\" },\r\n  draftUrl              (identifier           ){ return `/api/v2013/documents/${encodeURIComponent(identifier)}/versions/draft` },\r\n  draftSecurityUrl      (identifier, operation){ return `/api/v2013/documents/${encodeURIComponent(identifier)}/versions/draft/securities/${encodeURIComponent(operation)}` },\r\n  draftLockUrl          (identifier, lockID   ){ return `/api/v2013/documents/${encodeURIComponent(identifier)}/versions/draft/locks/${encodeURIComponent(lockID)}` },\r\n  draftLockListUrl      (identifier           ){ return `/api/v2013/documents/${encodeURIComponent(identifier)}/versions/draft/locks` },\r\n}\r\n\r\nexport class KmDraftsApi extends ApiBase\r\n{\r\n  #realm;\r\n  constructor(options) {    \r\n    super(options);\r\n    this.self = this;\r\n    this.#realm = options.realm;\r\n  }\r\n\r\n  async query({realm, q, s, l, sk }={}){  \r\n    const params = stringifyUrlParams( {    \r\n      $filter:q, \r\n      $orderby:s,\r\n      $top:l,\r\n      $skip:sk, \r\n      collection : \"mydraft\"  \r\n    });\r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n    const data =  this.http.get(serviceUrls.documentQueryUrl(), { headers, params} )\r\n                           .then(res => res.data)\r\n                           .catch(tryCastToApiError);\r\n     \r\n    if(data?.Items?.length){\r\n      data.Items = data.Items.map(e=>{\r\n            if(e.workingDocumentBody){\r\n                e.body = e.workingDocumentBody;\r\n            }\r\n            return e;\r\n      });\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  async get(identifier, {realm}={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n    \r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n    const data =  this.http.get(serviceUrls.draftUrl(identifier), { headers })\r\n                           .then(res => res.data)\r\n                           .catch(tryCastToApiError);\r\n    \r\n    if(data.workingDocumentBody){\r\n        data.body = data.workingDocumentBody;\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  async exists( identifier, {realm}={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n     return this.http.head(serviceUrls.draftUrl(identifier), { headers })\r\n                     .then(res => res.data)\r\n                     .catch(tryCastToApiError);\r\n  }\r\n\r\n  async put( identifier, body, {realm, schema}={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n    if(!isValid(body)) throw Error(`invalid value for body`);  \r\n\r\n    const params = stringifyUrlParams( {schema}); \r\n\r\n    const Realm =  { Realm : realm || this.#realm || undefined };\r\n    const ContentType = { 'Content-Type': 'application/json' };\r\n    const headers =  { ...Realm , ...ContentType}\r\n\r\n    return this.http.put(serviceUrls.draftUrl(identifier),  body , { headers, params })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n  async delete(identifier, {realm}={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n    return this.http.delete(serviceUrls.draftUrl(identifier), { headers })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n  \r\n  async canCreate(identifier, {realm, schema, metadata }={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n\r\n    const params = stringifyUrlParams( {schema, metadata }); \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n    return this.http.get(serviceUrls.draftSecurityUrl(identifier, 'create'), { headers, params })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n  async canUpdate(identifier, {realm, metadata}={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n    const params = stringifyUrlParams( {metadata}); \r\n    return this.http.get(serviceUrls.draftSecurityUrl(identifier, 'update'), { headers, params })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n  async canDelete(identifier, {realm}={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n    return this.http.get(serviceUrls.draftSecurityUrl(identifier, 'delete'), { headers })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n}\r\n\r\n\r\nexport class KmLocksApi extends ApiBase\r\n{\r\n  #realm;\r\n  constructor(options) {    \r\n    super(options);\r\n    this.self = this;\r\n    this.#realm = options.realm;\r\n  }\r\n\r\n  async query(identifier, {realm}={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n \r\n    return this.http.get(serviceUrls.draftLockListUrl(identifier), { headers })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n  async get(identifier, lockID, {realm}={} ){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n    if(!isValid(lockID)) throw Error(`invalid value for lockID`); \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n    return this.http.get(serviceUrls.draftLockUrl(identifier, lockID), { headers })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n  async exists(identifier,lockID, {realm}={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n    if(!isValid(lockID)) throw Error(`invalid value for lockID`); \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n    return this.http.head(serviceUrls.draftLockUrl(identifier, lockID), { headers })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }  \r\n \r\n  async put(identifier,lockID, body, {realm}={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n    if(!isValid(lockID)) throw Error(`invalid value for lockID`); \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n    \r\n    return this.http.put(serviceUrls.draftLockUrl(identifier,lockID), body, { headers })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n \r\n  async delete(identifier,lockID, {realm}={} ){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n    if(!isValid(lockID)) throw Error(`invalid value for lockID`); \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n    return this.http.delete(serviceUrls.draftLockUrl(identifier,lockID), { headers })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n}\r\n"],"names":["sitePrefixUrl","test","_window","window","location","hostname","_window2","_window3","defaultOptions","prefixUrl","timeout","token","Vue","_Vue__namespace$proto","prototype","$auth","strategy","get","ApiBase","constructor","options","_this","isFunction","tokenType","config","baseURL","http","loadAsyncHeaders","arguments","head","post","put","patch","delete","request","baseConfig","headers","Authorization","concat","axios","create","tryCastToApiError","error","response","data","code","stringifyUrlParam","value","Date","toISOString","Object","JSON","stringify","stringifyUrlParams","valueObj","returnObj","key","entries","isValid","params","undefined","includes","serviceUrls","documentQueryUrl","draftUrl","identifier","encodeURIComponent","draftSecurityUrl","operation","draftLockUrl","lockID","draftLockListUrl","_realm","WeakMap","KmDraftsApi","_classPrivateFieldInitSpec","self","_classPrivateFieldSet","realm","query","_data$Items","q","s","l","sk","length","$filter","$orderby","$top","$skip","collection","Realm","_classPrivateFieldGet","then","res","catch","Items","map","e","workingDocumentBody","body","Error","exists","schema","ContentType","canCreate","metadata","canUpdate","canDelete","_realm2","KmLocksApi"],"mappings":"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"}