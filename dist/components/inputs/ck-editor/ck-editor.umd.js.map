{"version":3,"file":"ck-editor.umd.js","sources":["../../../../src/services/composables/i18n.js","../../../../src/services/util/utils.js","../../../../src/services/api/api-base.js","../../../../src/services/api/km-storage/KmDocuments.js","../../../../src/services/api/km-storage/KmDrafts.js","../../../../src/services/api/km-storage/KmStorage.js","../../../../src/components/inputs/ck-editor/ck-editor.vue"],"sourcesContent":["export const  useI18n = ()=>{\r\n    return {\r\n        t       : (key)=>key,\r\n        locale  : 'en'\r\n    }\r\n}","export const useLogger = ()=>{\r\n    return {\r\n        error\r\n    }\r\n}\r\n\r\n\r\n\r\nfunction error(appError, userMessage){\r\n\r\n    if(![404, 401, 403].includes(appError?.status)){\r\n\r\n        try{\r\n            console.error(appError);\r\n            \r\n            const { ACCOUNTS_HOST_URL, TAG, COMMIT } = useRuntimeConfig().public;\r\n            const realmConfStore  = useRealmConfStore();\r\n            const realmConf = realmConfStore.realmConf; \r\n            //TODO: send error to server\r\n            const errorLog = {\r\n                stack : JSON.stringify(appError, Object.getOwnPropertyNames(appError)), \r\n                message: JSON.stringify(userMessage || appError?.message || 'unknown'),\r\n                url      : window.location.href,\r\n                userAgent: window.navigator.userAgent,\r\n                ver      : TAG||COMMIT,\r\n                timestamp: new Date(),\r\n                realm : realmConf.realm\r\n            }; \r\n\r\n            useAPIFetch('/error-logs', {method:'POST', body: errorLog});\r\n        }\r\n        catch(err){\r\n            console.error(err, 'error sending error log to server.')\r\n        }\r\n    }\r\n        \r\n    if(userMessage){\r\n        const $toast = useToast();\r\n        $toast.error(userMessage, {position:'top-right'}); \r\n    }\r\n}\r\n","import axios from 'axios'\r\nimport { isFunction } from 'lodash'\r\nimport * as Vue from 'vue'\r\n\r\nlet sitePrefixUrl = 'https://api.cbd.int';\r\n\r\nif(/\\.cbd\\.int$/i   .test(window?.location?.hostname || '')) sitePrefixUrl= 'https://api.cbd.int';\r\nif(/\\.cbddev\\.xyz$/i.test(window?.location?.hostname || '')) sitePrefixUrl= 'https://api.cbddev.xyz';\r\nif(/\\localhost$/i   .test(window?.location?.hostname || '')) sitePrefixUrl= '/';\r\n\r\nconst defaultOptions = { \r\n   prefixUrl:  sitePrefixUrl, \r\n   timeout  : 30 * 1000,\r\n   token: Vue?.prototype?.$auth?.strategy?.token?.get()  \r\n}\r\n\r\nexport default class ApiBase\r\n{\r\n  constructor(options) {\r\n    options = options || {};\r\n\r\n    if(isFunction(options)) options = { token : options }\r\n\r\n    const { token, prefixUrl, timeout, tokenType } = { ...defaultOptions, ...options }\r\n\r\n    this.config = {\r\n      baseURL : prefixUrl,\r\n      timeout,\r\n      tokenType,\r\n      token,\r\n    }\r\n\r\n    const http = async function (...args) {   \r\n      return (await loadAsyncHeaders(this.config))(...args);\r\n    }\r\n\r\n    http.get     = async (...args)=> (await loadAsyncHeaders(this.config)).get    (...args);\r\n    http.head    = async (...args)=> (await loadAsyncHeaders(this.config)).head   (...args);\r\n    http.post    = async (...args)=> (await loadAsyncHeaders(this.config)).post   (...args);\r\n    http.put     = async (...args)=> (await loadAsyncHeaders(this.config)).put    (...args);\r\n    http.patch   = async (...args)=> (await loadAsyncHeaders(this.config)).patch  (...args);\r\n    http.delete  = async (...args)=> (await loadAsyncHeaders(this.config)).delete (...args);\r\n    http.options = async (...args)=> (await loadAsyncHeaders(this.config)).options(...args);\r\n    http.request = async (...args)=> (await loadAsyncHeaders(this.config)).request(...args);\r\n\r\n    this.http = http;\r\n  }\r\n}\r\n\r\nasync function loadAsyncHeaders(baseConfig) {\r\n\r\n  const { token, tokenType, ...config } = baseConfig || {}\r\n\r\n  const headers = { ...(config.headers || {}) };\r\n\r\n  if(token) {\r\n      headers.Authorization = `${tokenType||'Bearer'} ${token}`;\r\n  }\r\n\r\n  return axios.create({ ...config, headers } );\r\n\r\n}\r\n\r\n//////////////////////////\r\n// Helpers\r\n////////////////////////\r\n\r\nexport function tryCastToApiError(error) {\r\n\r\n  if(error && error.response && error.response.data && error.response.data.code) {\r\n      const apiError = error.response.data\r\n      throw error.response.data;\r\n  }\r\n\r\n  throw error\r\n}\r\n\r\nexport function stringifyUrlParam(value) {\r\n  if (value instanceof(Date))   {return value.toISOString()}    \r\n  if (value instanceof(Object)) {return JSON.stringify(value)}  \r\n  return value; \r\n}\r\n\r\nexport function stringifyUrlParams(valueObj) {\r\n  const returnObj = {};\r\n\r\n  for (const [key, value] of Object.entries(valueObj)) {\r\n    if (isValid(value)){\r\n      returnObj[key] = stringifyUrlParam(value);\r\n    }\r\n  }\r\n  \r\n  return returnObj;\r\n}\r\n\r\nexport function mapObjectId(id){  \r\n  return isObjectId(id)? { $oid: id } : id\r\n}\r\n\r\nexport function isObjectId(id){\r\n  return /^[a-f0-9]{24}/i.test(id);\r\n}\r\n\r\nexport function isValid(params){\r\n  return ![undefined, null].includes(params);\r\n}","import ApiBase, { tryCastToApiError, isValid, stringifyUrlParams } from '../api-base';\r\n\r\nconst  serviceUrls = { \r\n  documentQueryUrl      (                     ){ return \"/api/v2013/documents\" },\r\n  documentUrl           (identifier           ){ return `/api/v2013/documents/${encodeURIComponent(identifier)}` },\r\n  documentInfoUrl       (identifier           ){ return `/api/v2013/documents/${encodeURIComponent(identifier)}/info` }, \r\n  validateUrl           (                     ){ return \"/api/v2013/documents/x/validate\" },\r\n  attachmentUrl         (identifier, filename ){ return `/api/v2013/documents/${encodeURIComponent(identifier)}/attachments/${encodeURIComponent(filename)}` },\r\n  temporaryAttachmentUrl(                     ){ return `/api/v2015/temporary-files` },\r\n  persistAttachmentUrl  (identifier, guid     ){ return `/api/v2013/documents/${encodeURIComponent(identifier)}/attachments/persist-temporary/${encodeURIComponent(guid)}` },\r\n  securityUrl           (identifier, operation){ return `/api/v2013/documents/${encodeURIComponent(identifier)}/securities/${encodeURIComponent(operation)}` },\r\n  documentVersionListUrl(identifier           ){ return `/api/v2013/documents/${encodeURIComponent(identifier)}/versions` },\r\n  documentVersionUrl    (identifier           ){ return `/api/v2013/documents/${encodeURIComponent(identifier)}/versions/:revision` },\r\n  documentVersionInfoUrl(identifier           ){ return `/api/v2013/documents/${encodeURIComponent(identifier)}/versions/:revision/info` } \r\n}\r\n\r\n\r\nexport class KmDocumentsApi extends ApiBase\r\n{\r\n  #realm;\r\n  constructor(options) {  \r\n    super(options );\r\n    this.self = this;\r\n    this.#realm = options.realm;\r\n  }\r\n\r\n  async query( {realm, q, s, l, sk }={}){\r\n    const params = stringifyUrlParams( { \r\n      $filter:q, \r\n      $orderby:s,\r\n      $skip:sk, \r\n      $top:l,\r\n      collection : \"my\"\r\n    });\r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n    \r\n    return this.http.get(serviceUrls.documentQueryUrl(), { headers, params } )\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n  async get(identifier, {realm}={} ){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`); \r\n        \r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n    return this.http.get(serviceUrls.documentUrl(identifier) ,{ headers } )\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n\r\n  async getInfo(identifier, {realm}={} ){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`); \r\n        \r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n    return this.http.get(serviceUrls.documentInfoUrl(identifier) ,{ headers } )\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n  async exists( identifier, {realm}={} ){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`); \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n    return this.http.head(serviceUrls.documentUrl(identifier), { headers })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n  async put( identifier, body, {realm}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n    if(!isValid(body)) throw Error(`invalid value for body`);  \r\n  \r\n    const Realm =  { Realm : realm || this.#realm || undefined };  \r\n    const ContentType = { 'Content-Type': 'application/json' };\r\n    const headers =  { ...Realm , ...ContentType}\r\n    \r\n    return this.http.put(serviceUrls.documentUrl(identifier), body , { headers })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n  async delete(identifier, {realm}={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };  \r\n\r\n    return this.http.delete(serviceUrls.documentUrl(identifier), { headers })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n   \r\n  async validate(body, {realm, schema, metadata }={}){\r\n    if(!isValid(body)) throw Error(`invalid value for body`);  \r\n\r\n    const params = stringifyUrlParams( { schema, metadata });\r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };  \r\n   \r\n    return this.http.put(serviceUrls.validateUrl(), body, { headers, params } )\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n  async canCreate(identifier, {realm, schema, metadata}={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n    if(!isValid(schema)) throw Error(`invalid value for schema`);  \r\n\r\n    const params = stringifyUrlParams({ schema, metadata });\r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };  \r\n\r\n    return this.http.get(serviceUrls.securityUrl(identifier, 'create'), { headers, params })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n  async canUpdate(identifier,  {realm, metadata }={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n\r\n    const params = stringifyUrlParams( {metadata });\r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };  \r\n\r\n    return this.http.get(serviceUrls.securityUrl(identifier, 'update'), { headers, params })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  } \r\n \r\n  async canDelete(identifier, {realm}={} ){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`); \r\n    \r\n    const headers =  { Realm : realm || this.#realm || undefined };  \r\n   \r\n    return this.http.get(serviceUrls.securityUrl(identifier, 'delete'), { headers })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n}\r\n\r\nexport class KmDocumentsVersionApi extends ApiBase\r\n{\r\n  #realm;\r\n  constructor(options) {    \r\n    super(options);\r\n    this.self = this;\r\n    this.#realm = options.realm;\r\n  }\r\n  \r\n\r\n  async query(identifier, {realm}={}){\r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };  \r\n    \r\n    return this.http.get(serviceUrls. documentVersionListUrl(identifier) , { headers, params } )\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n  async get(identifier, {realm}={} ){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`); \r\n        \r\n    const headers =  { Realm : realm || this.#realm || undefined };  \r\n\r\n    return this.http.get(serviceUrls.documentVersionUrl(identifier) ,{ headers } )\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n\r\n  async getInfo(identifier, {realm}={} ){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`); \r\n        \r\n    const headers =  { Realm : realm || this.#realm || undefined };  \r\n\r\n    return this.http.get(serviceUrls.documentVersionInfoUrl(identifier) ,{ headers } )\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n  async exists( identifier, {realm}={} ){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`); \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };  \r\n\r\n    return this.http.head(serviceUrls.documentVersionUrl(identifier), { headers })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n}\r\n\r\nexport class KmAttachmentsApi extends ApiBase\r\n{\r\n  #realm;\r\n  constructor(options) {    \r\n    super(options);\r\n    this.self = this;\r\n    this.#realm = options.realm;\r\n  }\r\n\r\n  async uploadTempFile(identifier, file, fileName, options)  {\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n    if(!isValid(file))       throw Error(`invalid value for file`);  \r\n    if(!isValid(fileName))   throw Error(`invalid value for fileName`);  \r\n    if(!isValid(options))    throw Error(`invalid value for options`);  \r\n    \r\n    \r\n    const { timeout, onUploadProgress, onDownloadProgress }= { ...(options||{}) };\r\n\r\n    const apiConfig = {\r\n      headers: {},\r\n      timeout: timeout || 60 * 60 * 1000,\r\n      onUploadProgress, \r\n      onDownloadProgress\r\n    };\r\n    \r\n    const tempSlotBody = {\r\n        filename    : fileName,\r\n    }\r\n\r\n    //find the content type and validate with whitelist\r\n    if(file instanceof FormData){\r\n        const tempFile = formData.get('file')\r\n        if(tempFile){\r\n            tempSlotBody.contentType = this.getMimeType(file);\r\n        }\r\n    }\r\n    else if(file instanceof File){\r\n        tempSlotBody.contentType = this.getMimeType(file)\r\n    }\r\n    else{\r\n        throw new Error('Unable to read file information.')\r\n    }\r\n    \r\n    if (this.mimeTypeWhitelist().indexOf(tempSlotBody.contentType) < 0) {\r\n        throw new Error(\"File type not supported: \" + mimeType + \"(\" + file.name + \")\");\r\n    }\r\n\r\n    //const key = S4();\r\n    // get a temporary slot from S3 to upload the file\r\n    const temporarySlot = this.http.put(serviceUrls.temporaryAttachmentUrl(),  tempSlotBody  )\r\n                                   .then(res => res.data)\r\n                                   .catch(tryCastToApiError);\r\n    \r\n    // upload the file to the temporary slot on S3    \r\n    apiConfig.headers['Content-Type' ] = temporarySlot.contentType;\r\n    //apiConfig.headers['Authorization'] = undefined;\r\n    const temporaryAttachment =  this.http.put(temporarySlot.url, file,  {  ...apiConfig} )\r\n                                         .then(res => res.data)\r\n                                         .catch(tryCastToApiError);\r\n\r\n    //persists the file using the KM persists attachments endpoint\r\n    const persistedAttachment =  this.http.post(serviceUrls.persistAttachmentUrl(identifier, temporarySlot.uid), fileName,  { params } )\r\n                                          .then(res => res.data)\r\n                                          .catch(tryCastToApiError);\r\n    \r\n    const config = useRuntimeConfig();\r\n    return {\r\n        ...persistedAttachment,\r\n        url     : config.public.API_URL+persistedAttachment.url        \r\n    };\r\n  }\r\n\r\n  async upload(identifier, file,  {contentType, headers  }={}) {\r\n        if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n        if(!isValid(file)) throw Error(`invalid value for file`);  \r\n\r\n        params = {contentType, identifier, filename } || {};\r\n        params.identifier = identifier;\r\n        params.filename = file.name;\r\n\r\n        var contentType = params.contentType || this.getMimeType(file);\r\n\r\n        // params.contentType = undefined;\r\n        params.headers = params.header || {};\r\n        params.headers[\"Content-Type\"] = contentType;\r\n\r\n        ////TEMP////////////////\r\n            //upload to temp url\r\n            const data = this.http.put(serviceUrls.attachmentUrl(identifier, file.name), body=file,  { params } )\r\n                                  .then(res => res.data)\r\n                                  .catch(tryCastToApiError);\r\n            \r\n            const config = useRuntimeConfig()\r\n            data.url = config.public.API_URL+data.url;\r\n            data.urls = {//required by ckeditor\r\n                \"default\": data.url \r\n            };\r\n            \r\n            return data;\r\n        ///////TEMP////////////////\r\n\r\n      //TODO : use s3\r\n      //1 request for temp file from s3\r\n      //upload file \r\n      //return s3 location\r\n      //persist temp file location in api\r\n  }\r\n  getMimeType(file) {\r\n    if(!isValid(file)) throw Error(`invalid value for file`);  \r\n\r\n    const filename = file.name\r\n    let  sMimeType = file.type || \"application/octet-stream\";     \r\n\r\n    if (filename && sMimeType == \"application/octet-stream\") {\r\n        var sExt = \"\";\r\n        var iIndex = filename.lastIndexOf(\".\");\r\n\r\n        if (iIndex >= 0)\r\n            sExt = filename.substring(iIndex).toLowerCase();\r\n\r\n        if (sExt == \".json\") sMimeType = \"application/json\";\r\n        if (sExt == \".geojson\") sMimeType = \"application/json\";\r\n        if (sExt == \".xml\") sMimeType = \"application/xml\";\r\n    }\r\n\r\n    return sMimeType;\r\n  }\r\n  \r\n}\r\n\r\nexport const mimeTypeWhitelist =\r\n   [\r\n    \"application/json\",\"application/ogg\",\"application/pdf\",\"application/xml\",\"application/zip\",\r\n    \"application/x-zip\",\"application/x-zip-compressed\",\"audio/mpeg\",\"audio/x-ms-wma\",\"audio/x-wav\",\r\n    \"image/gif\",\"image/jpeg\", \"image/png\",\"image/bmp\",\r\n    \"image/tiff\",\r\n    \"text/csv\",\"text/html\",\"text/plain\",\"text/xml\",\"video/mpeg\",\"video/mp4\",\"video/quicktime\",\r\n    \"video/x-ms-wmv\",\"video/x-msvideo\",\"video/x-flv\",\"application/vnd.oasis.opendocument.text\",\r\n    \"application/vnd.oasis.opendocument.spreadsheet\",\"application/vnd.oasis.opendocument.presentation\",\"application/vnd.oasis.opendocument.graphics\",\r\n    \"application/vnd.ms-excel\",\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",\"application/vnd.ms-powerpoint\",\"application/msword\",\r\n    \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",\r\n  ]\r\n","import ApiBase, { tryCastToApiError, isValid, stringifyUrlParams } from '../api-base';\r\n\r\nconst  serviceUrls = { \r\n  documentQueryUrl      (                     ){ return \"/api/v2013/documents\" },\r\n  draftUrl              (identifier           ){ return `/api/v2013/documents/${encodeURIComponent(identifier)}/versions/draft` },\r\n  draftSecurityUrl      (identifier, operation){ return `/api/v2013/documents/${encodeURIComponent(identifier)}/versions/draft/securities/${encodeURIComponent(operation)}` },\r\n  draftLockUrl          (identifier, lockID   ){ return `/api/v2013/documents/${encodeURIComponent(identifier)}/versions/draft/locks/${encodeURIComponent(lockID)}` },\r\n  draftLockListUrl      (identifier           ){ return `/api/v2013/documents/${encodeURIComponent(identifier)}/versions/draft/locks` },\r\n}\r\n\r\nexport class KmDraftsApi extends ApiBase\r\n{\r\n  #realm;\r\n  constructor(options) {    \r\n    super(options);\r\n    this.self = this;\r\n    this.#realm = options.realm;\r\n  }\r\n\r\n  async query({realm, q, s, l, sk }={}){  \r\n    const params = stringifyUrlParams( {    \r\n      $filter:q, \r\n      $orderby:s,\r\n      $top:l,\r\n      $skip:sk, \r\n      collection : \"mydraft\"  \r\n    });\r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n    const data =  this.http.get(serviceUrls.documentQueryUrl(), { headers, params} )\r\n                           .then(res => res.data)\r\n                           .catch(tryCastToApiError);\r\n     \r\n    if(data?.Items?.length){\r\n      data.Items = data.Items.map(e=>{\r\n            if(e.workingDocumentBody){\r\n                e.body = e.workingDocumentBody;\r\n            }\r\n            return e;\r\n      });\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  async get(identifier, {realm}={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n    \r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n    const data =  this.http.get(serviceUrls.draftUrl(identifier), { headers })\r\n                           .then(res => res.data)\r\n                           .catch(tryCastToApiError);\r\n    \r\n    if(data.workingDocumentBody){\r\n        data.body = data.workingDocumentBody;\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  async exists( identifier, {realm}={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n     return this.http.head(serviceUrls.draftUrl(identifier), { headers })\r\n                     .then(res => res.data)\r\n                     .catch(tryCastToApiError);\r\n  }\r\n\r\n  async put( identifier, body, {realm, schema}={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n    if(!isValid(body)) throw Error(`invalid value for body`);  \r\n\r\n    const params = stringifyUrlParams( {schema}); \r\n\r\n    const Realm =  { Realm : realm || this.#realm || undefined };\r\n    const ContentType = { 'Content-Type': 'application/json' };\r\n    const headers =  { ...Realm , ...ContentType}\r\n\r\n    return this.http.put(serviceUrls.draftUrl(identifier),  body , { headers, params })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n  async delete(identifier, {realm}={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n    return this.http.delete(serviceUrls.draftUrl(identifier), { headers })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n  \r\n  async canCreate(identifier, {realm, schema, metadata }={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n\r\n    const params = stringifyUrlParams( {schema, metadata }); \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n    return this.http.get(serviceUrls.draftSecurityUrl(identifier, 'create'), { headers, params })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n  async canUpdate(identifier, {realm, metadata}={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n    const params = stringifyUrlParams( {metadata}); \r\n    return this.http.get(serviceUrls.draftSecurityUrl(identifier, 'update'), { headers, params })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n  async canDelete(identifier, {realm}={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n    return this.http.get(serviceUrls.draftSecurityUrl(identifier, 'delete'), { headers })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n}\r\n\r\n\r\nexport class KmLocksApi extends ApiBase\r\n{\r\n  #realm;\r\n  constructor(options) {    \r\n    super(options);\r\n    this.self = this;\r\n    this.#realm = options.realm;\r\n  }\r\n\r\n  async query(identifier, {realm}={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n \r\n    return this.http.get(serviceUrls.draftLockListUrl(identifier), { headers })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n  async get(identifier, lockID, {realm}={} ){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n    if(!isValid(lockID)) throw Error(`invalid value for lockID`); \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n    return this.http.get(serviceUrls.draftLockUrl(identifier, lockID), { headers })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n  async exists(identifier,lockID, {realm}={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n    if(!isValid(lockID)) throw Error(`invalid value for lockID`); \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n    return this.http.head(serviceUrls.draftLockUrl(identifier, lockID), { headers })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }  \r\n \r\n  async put(identifier,lockID, body, {realm}={}){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n    if(!isValid(lockID)) throw Error(`invalid value for lockID`); \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n    \r\n    return this.http.put(serviceUrls.draftLockUrl(identifier,lockID), body, { headers })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n \r\n  async delete(identifier,lockID, {realm}={} ){\r\n    if(!isValid(identifier)) throw Error(`invalid value for identifier`);  \r\n    if(!isValid(lockID)) throw Error(`invalid value for lockID`); \r\n\r\n    const headers =  { Realm : realm || this.#realm || undefined };\r\n\r\n    return this.http.delete(serviceUrls.draftLockUrl(identifier,lockID), { headers })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n}\r\n","import ApiBase from '../api-base';\r\nimport { KmDocumentsApi, KmDocumentsVersionApi, KmAttachmentsApi } from './KmDocuments'\r\nimport { KmDraftsApi, KmLocksApi } from './KmDrafts' \r\n\r\nexport default class KmStorageApi extends ApiBase \r\n{\r\n  constructor(options) {\r\n    super(options);\r\n    \r\n    this.documents           = new KmDocumentsApi(options);\r\n    this.documentsVersion    = new KmDocumentsVersionApi(options);\r\n    this.drafts              = new KmDraftsApi(options);\r\n    this.locks               = new KmLocksApi(options);\r\n    this.attachments         = new KmAttachmentsApi(options);    \r\n  }\r\n}\r\n\r\n","<template>\r\n    <div>\r\n      <div style=\"border: 1px solid #eee\" v-if=\"editorConfig\" class=\"vld-parent\">\r\n          <!-- <overlay-loading :active=\"isUploadingFile\" \r\n          :can-cancel=\"false\" background-color=\"rgb(9 9 9)\"\r\n          :is-full-page=\"false\">\r\n          <km-spinner size=\"lg\" \r\n              :message=\"t('uploadingFile')\"></km-spinner>\r\n      </overlay-loading>\r\n   -->\r\n      <ckeditor \r\n          v-model=\"binding\"\r\n          :editor=\"editor\"\r\n          :config=\"editorConfig\"\r\n          :tagName=\"tagName\"\r\n          :disabled=\"$attrs.disabled\"      \r\n          @ready=\"onEditorReady\"\r\n          @focus=\"onEditorFocus\"\r\n          @blur=\"onEditorBlur\"\r\n          @input=\"onEditorInput\"\r\n          @destroy=\"onEditorDestroy\"\r\n        ></ckeditor>\r\n      </div>\r\n      <p style=\"border: 1px solid #eee; border-top: none\">\r\n        {{ t('attachmentMessage') }}\r\n        <span class=\"float-end\" id=\"wordCountSec\" style=\"padding-right: 5px\">\r\n          <strong>{{ t('wordCount') }}: {{ wordCount }}</strong></span>\r\n      </p>\r\n      <p style=\"border: 1px solid #eee; border-top: none\" v-if=\"uploadErrors.length\">         \r\n          <div class=\"alert alert-danger\" role=\"alert\">\r\n            {{ t('uploadError') }} \r\n            <ul><li v-for=\"error in uploadErrors\" :key=\"error\">{{ error.file }}</li></ul>\r\n          </div>\r\n        </p>\r\n    </div>\r\n  </template>\r\n\r\n  <script setup> \r\n    import  \"@ckeditor/ckeditor5-vue/dist/ckeditor.js\";\r\n    import CKEditor   from '@ckeditor/ckeditor5-vue';\r\n    import ClassicEditor from '@scbd/ckeditor5-build-inline-full/build/ckeditor.js';    \r\n    import '@scbd/ckeditor5-build-inline-full/build/ckeditor.css';  \r\n    import { useI18n} from '../../../services/composables/i18n.js'\r\n    import { computed, onMounted, ref , defineComponent} from 'vue';\r\n    import { useLogger } from '../../../services/util/index.js';\r\n    import KmStorageApi from '../../../services/api/km-storage/KmStorage.js';\r\n\r\n    //   import OverlayLoading from 'vue3-loading-overlay';\r\n    //   import 'vue3-loading-overlay/dist/vue3-loading-overlay.css';\r\n    //   import KmSpinner from '../KmSpinner.vue';\r\n    \r\n    const model    = defineModel({type:String, required:true, default:''});\r\n\r\n    const props = defineProps( {     \r\n        tagName  : { type: String, required: false,default: 'div'},     \r\n        uploadUrl: { type: String, required: false},\r\n        config   : { type: Object, required: true},\r\n        identifier: { type: String, required: true}  \r\n    });    \r\n\r\n \r\n    const emit     = defineEmits(['update:modelValue', 'onFileUpload', 'onEditorDestroy']);\r\n\r\n    const api          = new KmStorageApi({});\r\n    const ckeditor     = CKEditor.component;\r\n    const editor       = ClassicEditor;\r\n    const uploadErrors = [];\r\n\r\n    const {t, locale }    = useI18n();\r\n    const wordCount       = ref(0);\r\n    const isUploadingFile = ref(false);\r\n\r\n    const  binding  = computed({       \r\n        get()      {  return model.value;  },        \r\n        set(value) {  emit('update:modelValue', value);  }\r\n    })      \r\n  \r\n     \r\n    const onEditorReady=(ed)  =>{    \r\n        class UploadAdapter {\r\n          constructor(loader) {\r\n            this.loader = loader;\r\n          }\r\n          upload() {\r\n            const loader = this.loader;\r\n            return this.loader.file.then(function(file){\r\n              \r\n              isUploadingFile.value = true;  \r\n              return api.attachments.uploadTempFile(props.identifier, file, file.name)   \r\n                  .then(function(success) {                 \r\n                      success.urls = { \"default\": success.url }\r\n                      loader.uploaded = success;\r\n                      return success;\r\n                  })\r\n                  .catch(function(error) {                   \r\n                      uploadErrors.push({file:file.name })  \r\n                      useLogger().error(error);                     \r\n                      throw error;\r\n                  })\r\n                  .finally(()=>{\r\n                      isUploadingFile.value = false;  \r\n                  });\r\n            })\r\n          }\r\n          abort() {\r\n          }\r\n        }\r\n        ed.plugins.get('FileRepository').createUploadAdapter = function(loader){\r\n            const uploadAdapter = new UploadAdapter(loader);\r\n            uploadAdapter.loader.on('change:uploaded' , onEditorImageUploaded);\r\n            return uploadAdapter;\r\n        };\r\n  \r\n        ed.editing.view.document.on('paste', function (eventInfo, data) {\r\n          // console.debug('paste', eventInfo, data)\r\n        })\r\n  \r\n        ed.editing.view.document.on('drop', async function (eventInfo, data) {\r\n          if(data.dataTransfer){\r\n              isUploadingFile.value = true;   \r\n  \r\n              const fileUploads = data.dataTransfer.files.map(function(file, i){\r\n                  const formData = new FormData();\r\n                  const fileType = file.type.substring( 0, 5 );\r\n                  const mimeType = api.attachments.getMimeType(file);   \r\n  \r\n                  if(fileType == \"image\")\r\n                      return;\r\n                  if (api.attachments.mimeTypeWhitelist().indexOf(mimeType) < 0) {   \r\n                      alert(\"File type not supported: \" + mimeType + \"(\" + file.name + \")\");\r\n                      return;\r\n                  }\r\n  \r\n                  formData.append('file', file);\r\n                  return api.attachments.uploadTempFile(props.identifier, file, file.name)   \r\n                      .then(function(success) {\r\n                          const viewFragment = ed.data.processor.toView('<span class=\"me-2\">&nbsp;<a rel=\"noopener noreferrer\" target=\"_blank\" href=\"'+success.url+'\">'+success.filename+ '</a>&nbsp;</span>' );\r\n                          const modelFragment = ed.data.toModel(viewFragment);\r\n                          ed.model.insertContent( modelFragment);\r\n                          onFileUpload({file:success});   \r\n                      })\r\n                      .catch(e=>{\r\n                          uploadErrors.push({file:file.name })   \r\n                          useLogger().error(e)\r\n                      })\r\n              });\r\n  \r\n              try{\r\n                  await Promise.all(fileUploads)\r\n              }\r\n              catch(e){\r\n                  useLogger().error(e)\r\n                }\r\n              finally{\r\n                  isUploadingFile.value = false   \r\n                };\r\n            }\r\n        })\r\n  \r\n        ed.model.document.on('change:data', function (eventInfo, data) {\r\n          // console.debug('change', eventInfo, data)\r\n        })\r\n  \r\n        function onEditorImageUploaded(eventInfo, name, value, oldValue){\r\n          // console.log((eventInfo, name, value, oldValue))\r\n          //TODO: check why url is not in event args\r\n            if(value.url){\r\n                onFileUpload({file:value})    \r\n            }\r\n        }  \r\n        emit('onEditorReady', ed);      \r\n    }\r\n     \r\n    const onEditorFocus=( event, editor )=> {\r\n        // console.debug( 'Editor focused.', { event, editor } );\r\n        emit('onEditorFocus', event, editor);\r\n    }\r\n\r\n    const onEditorBlur=( event, editor ) =>{\r\n        // console.debug( 'Editor blurred.', { event, editor } );\r\n        emit('onEditorBlur', event, editor);\r\n    }\r\n\r\n    const onEditorInput=( data, event, editor )=> {       \r\n        emit('onEditorInput', event, editor);     \r\n    }\r\n    \r\n    const  onEditorDestroy=( editor )=> {\r\n        // console.debug( 'Editor destroyed.', { editor } );\r\n        emit('onEditorDestroy', editor);\r\n    }\r\n    \r\n    const onFileUpload=(params)=>{\r\n        emit('onFileUpload', params);\r\n    }\r\n\r\n    const editorConfig = computed(()=>{     \r\n          return {\r\n            ...props.config,  \r\n            language: { ui: locale, content: locale },\r\n            wordCount: {\r\n                onUpdate: function (stats) {\r\n                    wordCount.value = stats.words;\r\n                },\r\n            }\r\n        }          \r\n    })\r\n \r\n  \r\n  </script>\r\n\r\n  <style scope>  \r\n    .ck.ck-balloon-panel.ck-balloon-panel_visible {\r\n        /* stylelint-disable-line */\r\n        z-index: 10000 !important;\r\n    }\r\n  </style>\r\n"],"names":["useI18n","t","key","locale","useLogger","error","appError","userMessage","includes","status","console","ACCOUNTS_HOST_URL","TAG","COMMIT","useRuntimeConfig","public","realmConfStore","useRealmConfStore","realmConf","errorLog","stack","JSON","stringify","Object","getOwnPropertyNames","message","url","window","location","href","userAgent","navigator","ver","timestamp","Date","realm","useAPIFetch","method","body","err","$toast","useToast","position","sitePrefixUrl","test","_window","hostname","_window2","_window3","defaultOptions","prefixUrl","timeout","token","Vue","_Vue__namespace$proto","prototype","$auth","strategy","get","ApiBase","constructor","options","_this","isFunction","tokenType","config","baseURL","http","loadAsyncHeaders","arguments","head","post","put","patch","delete","request","baseConfig","headers","Authorization","concat","axios","create","tryCastToApiError","response","data","code","stringifyUrlParam","value","toISOString","stringifyUrlParams","valueObj","returnObj","entries","isValid","params","undefined","serviceUrls","documentQueryUrl","documentUrl","identifier","encodeURIComponent","documentInfoUrl","validateUrl","attachmentUrl","filename","temporaryAttachmentUrl","persistAttachmentUrl","guid","securityUrl","operation","documentVersionListUrl","documentVersionUrl","documentVersionInfoUrl","_realm","WeakMap","KmDocumentsApi","_classPrivateFieldInitSpec","self","_classPrivateFieldSet","query","q","s","l","sk","length","$filter","$orderby","$skip","$top","collection","Realm","_classPrivateFieldGet","then","res","catch","Error","getInfo","exists","_ref","ContentType","validate","schema","metadata","canCreate","canUpdate","canDelete","_realm2","KmDocumentsVersionApi","_realm3","KmAttachmentsApi","uploadTempFile","file","fileName","onUploadProgress","onDownloadProgress","apiConfig","tempSlotBody","FormData","tempFile","formData","contentType","getMimeType","File","mimeTypeWhitelist","indexOf","mimeType","name","temporarySlot","persistedAttachment","uid","API_URL","upload","_this2","header","urls","e","Promise","reject","sMimeType","type","sExt","iIndex","lastIndexOf","substring","toLowerCase","draftUrl","draftSecurityUrl","draftLockUrl","lockID","draftLockListUrl","_realm4","KmDraftsApi","_data$Items","Items","map","workingDocumentBody","_realm5","KmLocksApi","KmStorageApi","documents","documentsVersion","drafts","locks","attachments","model","_useModel","__props","props","emit","__emit","api","ckeditor","CKEditor","component","editor","ClassicEditor","uploadErrors","wordCount","ref","isUploadingFile","binding","computed","set","onEditorReady","ed","UploadAdapter","loader","success","uploaded","push","finally","abort","plugins","createUploadAdapter","uploadAdapter","on","onEditorImageUploaded","editing","view","document","eventInfo","dataTransfer","fileUploads","files","i","fileType","alert","append","viewFragment","processor","toView","modelFragment","toModel","insertContent","onFileUpload","all","oldValue","onEditorFocus","event","onEditorBlur","onEditorInput","onEditorDestroy","editorConfig","language","ui","content","onUpdate","stats","words"],"mappings":"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"}