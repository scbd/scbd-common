{"version":3,"file":"km-input-lstring-ml.js","sources":["../../../src/components/controls/km-input-lstring.vue","../../../src/services/util/helper.js","../../../src/components/controls/km-input-lstring-ml.vue"],"sourcesContent":["<template>\r\n  <div class=\"scbd-controls km-input-lstring\" >\r\n    <slot></slot>\r\n    <div class=\"input-group mb-1\" v-for=\"locale in locales\" :key=\"locale\" :class=\"`km-input-lstring-${locale}`\">\r\n      <input     v-if=\"rows==1\" type=\"text\"  class=\"form-control\" :placeholder=\"placeholder\" aria-describedby=\"lstring-text\"     v-model=\"model[locale]\" :dir=\"locale == 'ar' ? 'rtl' : 'ltr'\" @input=\"$emit('update:modelValue', model)\"/> \r\n      <textarea  v-if=\"rows>1\"  :rows=rows   class=\"form-control\" :placeholder=\"placeholder\" aria-describedby=\"lstring-textarea\" v-model=\"model[locale]\" :dir=\"locale == 'ar' ? 'rtl' : 'ltr'\" @input=\"$emit('update:modelValue', model)\"/>      \r\n    \r\n      <div class=\"input-group-append\">\r\n        <button class=\"btn btn-outline-primary\" type=\"button\" id=\"basic-addon2\" :data-bs-toggle=\"'tooltip'\" :data-bs-placement=\"'top'\" :title=\"getTerm(locale).title\">\r\n          {{ locale.toUpperCase() }}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\n    import { watch, onMounted } from \"vue\";\r\n    import { without } from \"lodash\";\r\n\r\n    const model = defineModel({type:Object, required: true, default:{}})\r\n    const props = defineProps({\r\n      locales:  { type: Array, required: true },\r\n      disabled: { type: Boolean, default: false },\r\n      rows:     { type: Number, required: false, default: 1 },\r\n      placeholder: {type: String, required: false }\r\n    });\r\n\r\n    const loadLanguages = () => {\r\n      props.locales?.forEach((e) => {\r\n        //TODO: call thesaurus service API\r\n      });\r\n    };\r\n\r\n    const getTerm = (term) => {\r\n      //TODO: call thesaurus service API\r\n      return { title: term };\r\n    };\r\n\r\n    watch(()=>props.locales,\r\n      (newVal, oldVal) => {\r\n        const deleted = without(Object.keys(model.value), ...newVal);\r\n        if (deleted?.length) {\r\n          deleted.forEach((e) => {\r\n            model.value[e] = undefined;\r\n          });\r\n        }\r\n        loadLanguages();\r\n      }, {deep:true}\r\n    );\r\n\r\n    onMounted(() => {\r\n      loadLanguages();\r\n    });\r\n</script>\r\n","import _ from 'lodash';\r\n\r\nexport const makeSmallUid = () => {\r\n    const key = (S4() + S4()).toUpperCase();\r\n    return 'uid-' + key;\r\n}\r\n\r\nexport function S4() {\r\n    return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\r\n}\r\n\r\nexport const removeEmpty = (obj)=> {\r\n    return function remove(current) {\r\n      _.forOwn(current, function (value, key) {\r\n        if (_.isUndefined(value) || _.isNull(value) || _.isNaN(value) ||\r\n          (_.isString(value) && _.isEmpty(value)) ||\r\n          (_.isObject(value) && _.isEmpty(remove(value)))) {\r\n  \r\n          delete current[key];\r\n        }\r\n      });\r\n\r\n      if (_.isArray(current)) _.pull(current, undefined);\r\n  \r\n      return current;\r\n  \r\n    }(_.cloneDeep(obj));\r\n}","<template>\r\n  <div :id=\"$attrs.id\" class=\"scbd-controls km-input-lstring-ml\" :class=\"$attrs.class\">\r\n    <div v-for=\"(item, index) in binding\" :key=\"item\">\r\n      <div class=\"row\">\r\n        <div class=\"col-md-11\">\r\n          <km-input-lstring\r\n            v-model=\"item.value\"\r\n            :locales=\"props.locales\"\r\n            @update:modelValue=\"emitChange\"\r\n          ></km-input-lstring>\r\n        </div>\r\n        <div class=\"col-md-1\">\r\n          <button\r\n            :disabled=\"index == binding.length-1\"\r\n            class=\"btn btn-danger btn-sm\"\r\n            type=\"button\"\r\n            @click=\"removeItem(item, index)\"\r\n          >\r\n            <i class=\"bi bi-trash\"></i> {{ t(\"remove\") }}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport {\r\n  ref,\r\n  onMounted,\r\n  defineProps,\r\n  defineEmits,\r\n} from \"vue\";\r\nimport { isEmpty } from \"lodash\";\r\nimport KmInputLstring from \"./km-input-lstring.vue\";\r\nimport { removeEmpty } from \"../../services/util/helper.js\";\r\n\r\nfunction t(str) {\r\n  return str;\r\n}\r\nconst props = defineProps({\r\n  locales: {\r\n    type: Array,\r\n    required: true,\r\n    validator:(value) => {\r\n      return value.every(locale => locale.length <= 3); // we use ISO-2 but need support for ISO-3\r\n    }\r\n  },\r\n  modelValue: {\r\n    type: Array,\r\n    required: false,\r\n    default: () => [{}],\r\n  },\r\n  disabled: {\r\n    type: Boolean,\r\n    required: false,\r\n  },\r\n});\r\n\r\nconst emit = defineEmits([\"update:modelValue\"]);\r\nconst binding = ref([{ value: {} }]);\r\n\r\nfunction addItem() {\r\n  binding.value.push({ value: {} });\r\n}\r\n\r\nfunction removeItem(item, index) {\r\n  binding.value?.splice(index, 1);\r\n}\r\n\r\nfunction emitChange(value) {\r\n  const clean = removeEmpty(binding.value);\r\n \r\n  emit(\"update:modelValue\", clean?.map((e) => e.value));\r\n\r\n  if (binding.value?.length) {\r\n    if (!binding.value.some((e) => isEmpty(e.value))) {\r\n      addItem();\r\n    }\r\n  }\r\n}\r\n\r\nonMounted(() => {\r\n  if (props.modelValue) {\r\n    binding.value = props.modelValue.map((e) => {\r\n      return { value: e };\r\n    });\r\n  }\r\n});\r\n</script>\r\n\r\n<style scoped></style>\r\n"],"names":["_useModel"],"mappings":"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"}