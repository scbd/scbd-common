{"version":3,"file":"cbd-article.umd.js","sources":["../../../src/services/api/api-base.js","../../../src/services/api/articles.js","../../../src/services/filters/lstring.js","../../../src/components/articles/cbd-add-new-article.vue","../../../src/components/articles/cbd-add-new-article.vue?vue&type=template&id=8398571a&lang.js","../../../src/services/util/css.escape.js","../../../src/components/articles/cbd-article-cover-image.vue","../../../src/components/articles/cbd-article.vue","../../../src/components/articles/cbd-article.vue?vue&type=template&id=6420104c&lang.js"],"sourcesContent":["import axios from 'axios'\r\nimport { isFunction } from 'lodash'\r\nimport * as Vue from 'vue'\r\n\r\nlet sitePrefixUrl = 'https://api.cbd.int';\r\n\r\nif(/\\.cbd\\.int$/i   .test(window?.location?.hostname || '')) sitePrefixUrl= 'https://api.cbd.int';\r\nif(/\\.cbddev\\.xyz$/i.test(window?.location?.hostname || '')) sitePrefixUrl= 'https://api.cbddev.xyz';\r\nif(/\\localhost$/i   .test(window?.location?.hostname || '')) sitePrefixUrl= '/';\r\n\r\nconst defaultOptions = { \r\n   prefixUrl:  sitePrefixUrl, \r\n   timeout  : 30 * 1000,\r\n   token: Vue?.prototype?.$auth?.strategy?.token?.get()  \r\n}\r\n\r\nexport default class ApiBase\r\n{\r\n  constructor(options) {\r\n    options = options || {};\r\n\r\n    if(isFunction(options)) options = { token : options }\r\n\r\n    const { token, prefixUrl, timeout, tokenType } = { ...defaultOptions, ...options }\r\n\r\n    this.config = {\r\n      baseURL : prefixUrl,\r\n      timeout,\r\n      tokenType,\r\n      token,\r\n    }\r\n\r\n    const http = async function (...args) {   \r\n      return (await loadAsyncHeaders(this.config))(...args);\r\n    }\r\n\r\n    http.get     = async (...args)=> (await loadAsyncHeaders(this.config)).get    (...args);\r\n    http.head    = async (...args)=> (await loadAsyncHeaders(this.config)).head   (...args);\r\n    http.post    = async (...args)=> (await loadAsyncHeaders(this.config)).post   (...args);\r\n    http.put     = async (...args)=> (await loadAsyncHeaders(this.config)).put    (...args);\r\n    http.patch   = async (...args)=> (await loadAsyncHeaders(this.config)).patch  (...args);\r\n    http.delete  = async (...args)=> (await loadAsyncHeaders(this.config)).delete (...args);\r\n    http.options = async (...args)=> (await loadAsyncHeaders(this.config)).options(...args);\r\n    http.request = async (...args)=> (await loadAsyncHeaders(this.config)).request(...args);\r\n\r\n    this.http = http;\r\n  }\r\n}\r\n\r\nasync function loadAsyncHeaders(baseConfig) {\r\n\r\n  const { token, tokenType, ...config } = baseConfig || {}\r\n\r\n  const headers = { ...(config.headers || {}) };\r\n\r\n  if(token) {\r\n      headers.Authorization = `${tokenType||'Bearer'} ${token}`;\r\n  }\r\n\r\n  return axios.create({ ...config, headers } );\r\n\r\n}\r\n\r\n//////////////////////////\r\n// Helpers\r\n////////////////////////\r\n\r\nexport function tryCastToApiError(error) {\r\n\r\n  if(error && error.response && error.response.data && error.response.data.code) {\r\n      const apiError = error.response.data\r\n      throw error.response.data;\r\n  }\r\n\r\n  throw error\r\n}\r\n\r\nexport function stringifyUrlParam(value) {\r\n  if (value instanceof(Date))   {return value.toISOString()}    \r\n  if (value instanceof(Object)) {return JSON.stringify(value)}  \r\n  return value; \r\n}\r\n\r\nexport function stringifyUrlParams(valueObj) {\r\n  const returnObj = {};\r\n\r\n  for (const [key, value] of Object.entries(valueObj)) {\r\n    if (isValid(value)){\r\n      returnObj[key] = stringifyUrlParam(value);\r\n    }\r\n  }\r\n  \r\n  return returnObj;\r\n}\r\n\r\nexport function mapObjectId(id){  \r\n  return isObjectId(id)? { $oid: id } : id\r\n}\r\n\r\nexport function isObjectId(id){\r\n  return /^[a-f0-9]{24}/i.test(id);\r\n}\r\n\r\nexport function isValid(params){\r\n  return ![undefined, null].includes(params);\r\n}","\r\nimport ApiBase, { tryCastToApiError, stringifyUrlParam, stringifyUrlParams, isValid, mapObjectId} from './api-base';\r\n\r\nexport default class ArticlesApi extends ApiBase\r\n{\r\n  constructor(options) {\r\n    super(options);\r\n  }\r\n  \r\n  async getArticleGroup(groupKey, {q, f, s, sk, l , c, fo, ag }={})  {    \r\n    if(!isValid(groupKey)) throw Error(`invalid value for groupKey`); \r\n    const params = stringifyUrlParams( {q, f, s, sk, l , c, fo, ag });\r\n\r\n    return this.http.get(`api/v2017/articles/grouping/${encodeURIComponent(groupKey)}`,  { params } )\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n   }\r\n\r\n  async getArticles({q, f, s, sk, l , c, fo, ag }={})  {\r\n    const params = stringifyUrlParams( {q, f, s, sk, l , c, fo, ag });\r\n\r\n    return this.http.get(`api/v2017/articles`,  { params } )\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n  }\r\n\r\n  async getArticleById(id )  {\r\n    if(!isValid(id)) throw Error(`invalid value for id`);\r\n\r\n    return this.http.get(`api/v2017/articles/${id}`)\r\n                      .then(res => res.data)\r\n                      .catch(tryCastToApiError);  \r\n  }\r\n\r\n\r\n  async getArticlesByTag(tag, {q, f, s, sk, l , c, fo, ag }={})  {    \r\n    if(!isValid(tag)) throw Error(`invalid value for tag`);\r\n\r\n   const params=  stringifyUrlParams({q, f, s, sk, l , c, fo, ag });\r\n   const query = q;   \r\n   \r\n   if (tag){\r\n    params.q = stringifyUrlParam({...query, ...{tags: mapObjectId(tag)}});    \r\n   } \r\n\r\n    return this.http.get(`api/v2017/articles`,  { params })\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);  \r\n }\r\n\r\n   \r\n\r\n  async getArticleAdminTags({q, f, s, sk, l , c, fo, ag }={}){    \r\n    const params = stringifyUrlParams( {q, f, s, sk, l , c, fo, ag });\r\n\r\n    return this.http.get(`api/v2021/article-admin-tags`,  { params } )\r\n                    .then(res => res.data)\r\n                    .catch(tryCastToApiError);\r\n\r\n  }\r\n }","\r\nexport function lstring(ltext, locale) {\r\n  \r\n    if(Number.isInteger(ltext)) //is number to handle generic implementation of NR\r\n      return ltext;\r\n  \r\n    if (!ltext)\r\n      return \"\";\r\n    if (typeof(ltext) == 'string')\r\n      return ltext;\r\n    let sText=\"\";\r\n    if (!sText && locale)\r\n      sText = ltext[locale];\r\n    if (!sText)\r\n      sText = ltext.en;\r\n    if (!sText) {\r\n      var normalized = normalizeText(ltext)\r\n      if(normalized[locale])\r\n        return normalized[locale];\r\n\r\n      for (var key in ltext) {\r\n        sText = ltext[key];\r\n        if (sText)\r\n          break;\r\n      }\r\n    }\r\n    return sText || \"\";\r\n}\r\n\r\n\r\nfunction normalizeText(text) {\r\n  if(!text) return null;\r\n\r\n  var entry = { ar: text.ar, en: text.en, es: text.es, fr: text.fr, ru: text.ru, zh: text.zh };\r\n\r\n  if(!entry.en) entry.en = entry.fr;\r\n  if(!entry.en) entry.en = entry.es;\r\n  if(!entry.en) entry.en = entry.ru;\r\n  if(!entry.en) entry.en = entry.ar;\r\n  if(!entry.en) entry.en = entry.zh;\r\n\r\n  if(!entry.fr) entry.fr = entry.en;\r\n  if(!entry.es) entry.es = entry.en;\r\n  if(!entry.ru) entry.ru = entry.en;\r\n  if(!entry.ar) entry.ar = entry.en;\r\n  if(!entry.zh) entry.zh = entry.en;\r\n  return entry;\r\n}","<template>\r\n     <a :href=\"newArticleUrl\" :target=\"target\">\r\n        <slot>\r\n            <span v-if=\"!id\"><i class=\"fa fa-plus\"></i> Add Content</span>\r\n            <span v-if=\"id\" ><i class=\"fa fa-edit\"></i> Edit Content</span>\r\n            \r\n        </slot>\r\n    </a>\r\n</template>\r\n\r\n<script>\r\n    export default {\r\n        name:'cbdAddNewArticle',\r\n        props: {\r\n            tags \t\t: { type: Array  , required: false, default:[]           }, // [] of tag id's\r\n            customTags \t: { type: Array  , required: false, default:[]           }, // [] of customTag id's\r\n            adminTags \t: { type: Array  , required: false, default:[]           }, // [] of adminTag text\r\n            target      : { type: String , required: false, default: '_blank'    },\r\n            id          : { type: String , required: false, default: undefined   },\r\n        },\r\n        computed: {\r\n            newArticleUrl : function(){\r\n\r\n                const domain = window.location.hostname.replace(/[^\\.]+\\./, '');\r\n\t\t\t\tlet baseUrl = 'https://www.cbd.int/management'\r\n\r\n\t\t\t\tif(domain=='localhost' || domain == 'cbddev.xyz')\r\n            \t\tbaseUrl = 'https://oasis.cbddev.xyz';\r\n\r\n\t\t\t\tconst queryString = [];\r\n                if(!this.id){\r\n                    if(this.tags?.length)\r\n                        queryString.push('tags='\t\t+ this.tags.map(encodeURIComponent).join(','))\r\n                    if(this.customTags?.length)\r\n                        queryString.push('customTags='\t+ this.customTags.map(encodeURIComponent).join(','))\r\n                    if(this.adminTags?.length)\r\n                        queryString.push('adminTags='\t+ this.adminTags.map(encodeURIComponent).join(','))\r\n                }\r\n\r\n                queryString.push('returnUrl=' + encodeURI(window.location.href));\r\n\r\n                if(!this.id)\r\n                    return `${baseUrl}/articles/new?${queryString.join('&')}`\r\n                \r\n                return  `${baseUrl}/articles/${encodeURIComponent(this.id)}/edit?${queryString.join('&')}`;\r\n            }\r\n        }\r\n    }\r\n</script>\r\n","<template>\r\n     <a :href=\"newArticleUrl\" :target=\"target\">\r\n        <slot>\r\n            <span v-if=\"!id\"><i class=\"fa fa-plus\"></i> Add Content</span>\r\n            <span v-if=\"id\" ><i class=\"fa fa-edit\"></i> Edit Content</span>\r\n            \r\n        </slot>\r\n    </a>\r\n</template>\r\n\r\n<script>\r\n    export default {\r\n        name:'cbdAddNewArticle',\r\n        props: {\r\n            tags \t\t: { type: Array  , required: false, default:[]           }, // [] of tag id's\r\n            customTags \t: { type: Array  , required: false, default:[]           }, // [] of customTag id's\r\n            adminTags \t: { type: Array  , required: false, default:[]           }, // [] of adminTag text\r\n            target      : { type: String , required: false, default: '_blank'    },\r\n            id          : { type: String , required: false, default: undefined   },\r\n        },\r\n        computed: {\r\n            newArticleUrl : function(){\r\n\r\n                const domain = window.location.hostname.replace(/[^\\.]+\\./, '');\r\n\t\t\t\tlet baseUrl = 'https://www.cbd.int/management'\r\n\r\n\t\t\t\tif(domain=='localhost' || domain == 'cbddev.xyz')\r\n            \t\tbaseUrl = 'https://oasis.cbddev.xyz';\r\n\r\n\t\t\t\tconst queryString = [];\r\n                if(!this.id){\r\n                    if(this.tags?.length)\r\n                        queryString.push('tags='\t\t+ this.tags.map(encodeURIComponent).join(','))\r\n                    if(this.customTags?.length)\r\n                        queryString.push('customTags='\t+ this.customTags.map(encodeURIComponent).join(','))\r\n                    if(this.adminTags?.length)\r\n                        queryString.push('adminTags='\t+ this.adminTags.map(encodeURIComponent).join(','))\r\n                }\r\n\r\n                queryString.push('returnUrl=' + encodeURI(window.location.href));\r\n\r\n                if(!this.id)\r\n                    return `${baseUrl}/articles/new?${queryString.join('&')}`\r\n                \r\n                return  `${baseUrl}/articles/${encodeURIComponent(this.id)}/edit?${queryString.join('&')}`;\r\n            }\r\n        }\r\n    }\r\n</script>\r\n","// https://raw.githubusercontent.com/mathiasbynens/CSS.escape/master/css.escape.js\r\n\t\r\nexport const cssEscape = function(value) {\r\n    if (arguments.length == 0) {\r\n        throw new TypeError('`CSS.escape` requires an argument.');\r\n    }\r\n    var string = String(value);\r\n    var length = string.length;\r\n    var index = -1;\r\n    var codeUnit;\r\n    var result = '';\r\n    var firstCodeUnit = string.charCodeAt(0);\r\n\r\n    if (\r\n        // If the character is the first character and is a `-` (U+002D), and\r\n        // there is no second character, […]\r\n        length == 1 &&\r\n        firstCodeUnit == 0x002D\r\n    ) {\r\n        return '\\\\' + string;\r\n    }\r\n\r\n    while (++index < length) {\r\n        codeUnit = string.charCodeAt(index);\r\n        // Note: there’s no need to special-case astral symbols, surrogate\r\n        // pairs, or lone surrogates.\r\n\r\n        // If the character is NULL (U+0000), then the REPLACEMENT CHARACTER\r\n        // (U+FFFD).\r\n        if (codeUnit == 0x0000) {\r\n            result += '\\uFFFD';\r\n            continue;\r\n        }\r\n\r\n        if (\r\n            // If the character is in the range [\\1-\\1F] (U+0001 to U+001F) or is\r\n            // U+007F, […]\r\n            (codeUnit >= 0x0001 && codeUnit <= 0x001F) || codeUnit == 0x007F ||\r\n            // If the character is the first character and is in the range [0-9]\r\n            // (U+0030 to U+0039), […]\r\n            (index == 0 && codeUnit >= 0x0030 && codeUnit <= 0x0039) ||\r\n            // If the character is the second character and is in the range [0-9]\r\n            // (U+0030 to U+0039) and the first character is a `-` (U+002D), […]\r\n            (\r\n                index == 1 &&\r\n                codeUnit >= 0x0030 && codeUnit <= 0x0039 &&\r\n                firstCodeUnit == 0x002D\r\n            )\r\n        ) {\r\n            // https://drafts.csswg.org/cssom/#escape-a-character-as-code-point\r\n            result += '\\\\' + codeUnit.toString(16) + ' ';\r\n            continue;\r\n        }\r\n\r\n        // If the character is not handled by one of the above rules and is\r\n        // greater than or equal to U+0080, is `-` (U+002D) or `_` (U+005F), or\r\n        // is in one of the ranges [0-9] (U+0030 to U+0039), [A-Z] (U+0041 to\r\n        // U+005A), or [a-z] (U+0061 to U+007A), […]\r\n        if (\r\n            codeUnit >= 0x0080 ||\r\n            codeUnit == 0x002D ||\r\n            codeUnit == 0x005F ||\r\n            codeUnit >= 0x0030 && codeUnit <= 0x0039 ||\r\n            codeUnit >= 0x0041 && codeUnit <= 0x005A ||\r\n            codeUnit >= 0x0061 && codeUnit <= 0x007A\r\n        ) {\r\n            // the character itself\r\n            result += string.charAt(index);\r\n            continue;\r\n        }\r\n\r\n        // Otherwise, the escaped character.\r\n        // https://drafts.csswg.org/cssom/#escape-a-character\r\n        result += '\\\\' + string.charAt(index);\r\n    }\r\n    return result;\r\n};\r\n","<template>\r\n     <div class=\"image-credit-wrapper\"  v-if=\"coverImage.url\">    \r\n        <div :class=\"'img cover-image cover-image-position-' + (coverImage.position||'center') + ' cover-image-size-' + (coverImage.size||'cover')\" \r\n            v-if=\"coverImage.url_1200||coverImage.url\" :style=\"'background-image: url(' + cssEscapeUrl(coverImage.url_1200||coverImage.url) + ');'\">\r\n        </div>    \r\n        <span class=\"image-credit\" v-if=\"coverImage.credits\">{{coverImage.credits}}</span>\r\n        <slot></slot>\r\n    </div>\r\n</template>\r\n \r\n<script setup>\r\n    import { cssEscape } from '../../services/util/css.escape';\r\n    const { coverImage } = defineProps({\r\n        coverImage: {\r\n            type: Object,\r\n            required: true\r\n        }\r\n    });\r\n    \r\n    const cssEscapeUrl = function(url) {\r\n        return cssEscape(url);\r\n    }\r\n    //  const cssEscapeUrl = (url) => cssEscape(url);\r\n\r\n</script>\r\n<style scoped>\r\n.image-credit-wrapper img {\r\n    width: 100% !important;\r\n}\r\n\r\n.image-credit-wrapper {\r\n    overflow: hidden;\r\n    position: relative;\r\n    /* margin-left: -15px;\r\n    margin-right: -15px; */\r\n    max-height: 375px;\r\n    width: 100%\r\n}\r\n\r\n.image-credit-wrapper .image-credit {\r\n    position: absolute;\r\n    right: 0px;\r\n    bottom: 4px;\r\n}\r\n\r\n.image-credit {\r\n    background: rgba(0, 0, 0, .7);\r\n    color: #ccc;\r\n    display: inline-block;\r\n    font-size: 11px;\r\n    font-family: helvetica;\r\n    font-weight: 300;\r\n    padding: 5px 8px;\r\n    position: absolute;\r\n    bottom: 0;\r\n    right: 0;\r\n}\r\n\r\n.cover-image{\r\n    width: 100%;\r\n    background-repeat: no-repeat;\r\n    position: absolute;\r\n    top: 0px;\r\n    right: 0px;\r\n    bottom: 0px;\r\n    left: 0px;\r\n\r\n}\r\n\r\n.cover-image-position-left{\r\n    background-position: left;\r\n}                                    \r\n.cover-image-position-right{\r\n    background-position: right;\r\n} \r\n.cover-image-position-top{\r\n    background-position: top;\r\n}                                    \r\n.cover-image-position-center{\r\n    background-position: center;\r\n}                                            \r\n.cover-image-position-bottom{\r\n    background-position: bottom;\r\n}\r\n\r\n.cover-image-size-cover{\r\n    background-size: cover;\r\n}\r\n.cover-image-size-contain{\r\n    background-size: contain;\r\n}\r\n@media (max-width: 767px) {\r\n    /*For all phone sizes*/\r\n    .image-credit-wrapper{\r\n        height: 120px;\r\n    }\r\n}\r\n\r\n@media (min-width: 768px) and (max-width: 991px) {\r\n    /* For IPads*/\r\n    .image-credit-wrapper{\r\n        height: 250px;\r\n    }\r\n}\r\n@media (min-width: 992px) and (max-width: 1199px) {\r\n    /* For IPad pro*/\r\n    .image-credit-wrapper{\r\n        height: 300px;\r\n    }\r\n}\r\n@media (min-width: 1200px) {\r\n    /* For big screens*/\r\n    .image-credit-wrapper{\r\n        height: 350px;\r\n    }\r\n}\r\n</style>\r\n","\r\n<template>\r\n   <div style=\"border:none;margin-top:10px\">\r\n        <div v-if=\"!loading\">\r\n        \r\n            <slot name=\"article-cover-image\">\r\n                <div v-if=\"!hideCoverImage && article && article.coverImage && article.coverImage.url\" >\r\n                    <cbd-article-cover-image :cover-image=\"article.coverImage\"></cbd-article-cover-image>\r\n                </div>\r\n            </slot>\r\n\r\n            <slot name=\"article-add-new\">\r\n                <div v-if=\"hasEditRights\" class=\"pull-right\">    \r\n                    <cbd-add-new-article :tags=\"tags\" :admin-tags=\"adminTags\" :custom-tags=\"customTags\" :id=\"(article||{})._id\" \r\n                        :target=\"showEditTarget\" class=\"btn btn-default\"></cbd-add-new-article>\r\n                </div>\r\n            </slot>\r\n            <slot name=\"article\">\r\n                <div v-if=\"article\" v-html=\"$options.filters.lstring(article.content, $locale)\" class=\"ck-content\"></div>\r\n            </slot>\r\n\r\n            <slot name=\"article-empty\">\r\n                <div v-if=\"!article\" class=\"ck-content\">No information is available for this section at the moment.</div>\r\n            </slot>\r\n\r\n        </div>\r\n        <slot name=\"article-loading\">\r\n            <div v-if=\"loading\">Loading content... <i class=\"fa fa-spinner fa-spin\"></i></div>\r\n        </slot>\r\n    </div>\r\n\r\n</template>\r\n\r\n<script>\r\n\r\nimport axios from 'axios';\r\nimport ArticlesApi from '../../services/api/articles';\r\nimport {lstring } from '../../services/filters/lstring'\r\nimport cbdAddNewArticle from './cbd-add-new-article.vue';\r\nimport cbdArticleCoverImage from './cbd-article-cover-image.vue';\r\n\r\nexport default {\r\n    name: 'cbdArticle',\r\n    components : { \r\n        cbdAddNewArticle, \r\n        cbdArticleCoverImage \r\n    },\r\n    props: {\r\n        hideCoverImage  : { type: Boolean, required: false, default:false        },\r\n        showEdit        : { type: Boolean, required: false, default:true         },\r\n        showEditTarget  : { type: String , required: false, default: '_self'     },\r\n        showEditRoles   : { type: Array  , required: false, default:[]           }, // [] of scope roles\r\n        article         : { type: Object,  required: false, default:undefined    },\r\n        query           : { type: Object,  required: false                       },\r\n        tags \t\t    : { type: Array  , required: false, default:[]           }, // [] of tag id's\r\n        customTags \t    : { type: Array  , required: false, default:[]           }, // [] of customTag id's\r\n        adminTags \t    : { type: Array  , required: false, default:[]           }, // [] of adminTag text\r\n    },\r\n    data() {\r\n        return {\r\n            returnUrl       : window.location.href,\r\n            hasEditRights   : false,\r\n            loading         : false\r\n        }\r\n    },\r\n    created() {\r\n       this.ArticlesApi = new ArticlesApi();\r\n    },\r\n    mounted() {\r\n        if(!this.article && this.query)\r\n            this.loadArticle();\r\n    },\r\n    methods: {\r\n        async loadArticle() {\r\n            try{\r\n                this.loading = true;\r\n                const query = this.query;\r\n                const articleResult = await this.ArticlesApi.queryArticles(query)\r\n     \r\n                if(articleResult.length){\r\n                    let lArticle = articleResult[0];\r\n\r\n                    this.preProcessOEmbed();\r\n\r\n                    if(lArticle.coverImage?.url){\r\n                        //sometime the file name has space/special chars, use new URL's href prop which encodes the special chars\r\n                        const url = new URL(lArticle.coverImage.url)\r\n                        lArticle.coverImage.url = url.href;\r\n\r\n                        lArticle.coverImage.url_1200  = lArticle.coverImage.url.replace(/attachments\\.cbd\\.int\\//, '$&1200x600/')\r\n                    }\r\n                    this.article = lArticle;\r\n                    this.$emit('load', { ...this.article });   \r\n                }\r\n                else {\r\n                    this.$emit('load');\r\n                }\r\n\r\n                this.$auth.fetchUser().then(()=>{\r\n                    if(this.showEdit || this.showEdit == 'true' || this.hasOwnProperty(this.showEdit)){\r\n\r\n                        let roles = [...this.showEditRoles, 'oasisArticleEditor', 'Administrator']\r\n                        this.hasEditRights = this.$auth.hasScope(roles);\r\n                    }\r\n                })\r\n            }\r\n            catch(e){\r\n                console.error(e)\r\n            }\r\n            finally{\r\n                this.loading = false;\r\n            }\r\n        },\r\n        preProcessOEmbed() {\r\n\r\n            setTimeout(function(){\r\n\r\n                document.querySelectorAll( 'oembed[url]' ).forEach(async function(element) {\r\n                    var url = element.attributes.url.value;\r\n                    var params = {\r\n                        url : encodeURI(url),\r\n                    }\r\n\r\n                    const response = await axios.get('/api/v2020/oembed', {params:params});                    \r\n                    var embedHtml = '<div class=\"ck-media__wrapper\" style=\"width:100%\">' + response.data.html +'</div>'\r\n                    element.insertAdjacentHTML(\"afterend\", embedHtml);\r\n                    \r\n                });\r\n\r\n            }, 500)\r\n        }\r\n    },\r\n    filters:{\r\n        lstring\r\n    }\r\n}\r\n</script>\r\n    \r\n<style>\r\n\r\n    @import url('https://cdn.jsdelivr.net/npm/@scbd/ckeditor5-build-inline-full@35.0.0/build/content-style.css');\r\n\r\n</style>\r\n","\r\n<template>\r\n   <div style=\"border:none;margin-top:10px\">\r\n        <div v-if=\"!loading\">\r\n        \r\n            <slot name=\"article-cover-image\">\r\n                <div v-if=\"!hideCoverImage && article && article.coverImage && article.coverImage.url\" >\r\n                    <cbd-article-cover-image :cover-image=\"article.coverImage\"></cbd-article-cover-image>\r\n                </div>\r\n            </slot>\r\n\r\n            <slot name=\"article-add-new\">\r\n                <div v-if=\"hasEditRights\" class=\"pull-right\">    \r\n                    <cbd-add-new-article :tags=\"tags\" :admin-tags=\"adminTags\" :custom-tags=\"customTags\" :id=\"(article||{})._id\" \r\n                        :target=\"showEditTarget\" class=\"btn btn-default\"></cbd-add-new-article>\r\n                </div>\r\n            </slot>\r\n            <slot name=\"article\">\r\n                <div v-if=\"article\" v-html=\"$options.filters.lstring(article.content, $locale)\" class=\"ck-content\"></div>\r\n            </slot>\r\n\r\n            <slot name=\"article-empty\">\r\n                <div v-if=\"!article\" class=\"ck-content\">No information is available for this section at the moment.</div>\r\n            </slot>\r\n\r\n        </div>\r\n        <slot name=\"article-loading\">\r\n            <div v-if=\"loading\">Loading content... <i class=\"fa fa-spinner fa-spin\"></i></div>\r\n        </slot>\r\n    </div>\r\n\r\n</template>\r\n\r\n<script>\r\n\r\nimport axios from 'axios';\r\nimport ArticlesApi from '../../services/api/articles';\r\nimport {lstring } from '../../services/filters/lstring'\r\nimport cbdAddNewArticle from './cbd-add-new-article.vue';\r\nimport cbdArticleCoverImage from './cbd-article-cover-image.vue';\r\n\r\nexport default {\r\n    name: 'cbdArticle',\r\n    components : { \r\n        cbdAddNewArticle, \r\n        cbdArticleCoverImage \r\n    },\r\n    props: {\r\n        hideCoverImage  : { type: Boolean, required: false, default:false        },\r\n        showEdit        : { type: Boolean, required: false, default:true         },\r\n        showEditTarget  : { type: String , required: false, default: '_self'     },\r\n        showEditRoles   : { type: Array  , required: false, default:[]           }, // [] of scope roles\r\n        article         : { type: Object,  required: false, default:undefined    },\r\n        query           : { type: Object,  required: false                       },\r\n        tags \t\t    : { type: Array  , required: false, default:[]           }, // [] of tag id's\r\n        customTags \t    : { type: Array  , required: false, default:[]           }, // [] of customTag id's\r\n        adminTags \t    : { type: Array  , required: false, default:[]           }, // [] of adminTag text\r\n    },\r\n    data() {\r\n        return {\r\n            returnUrl       : window.location.href,\r\n            hasEditRights   : false,\r\n            loading         : false\r\n        }\r\n    },\r\n    created() {\r\n       this.ArticlesApi = new ArticlesApi();\r\n    },\r\n    mounted() {\r\n        if(!this.article && this.query)\r\n            this.loadArticle();\r\n    },\r\n    methods: {\r\n        async loadArticle() {\r\n            try{\r\n                this.loading = true;\r\n                const query = this.query;\r\n                const articleResult = await this.ArticlesApi.queryArticles(query)\r\n     \r\n                if(articleResult.length){\r\n                    let lArticle = articleResult[0];\r\n\r\n                    this.preProcessOEmbed();\r\n\r\n                    if(lArticle.coverImage?.url){\r\n                        //sometime the file name has space/special chars, use new URL's href prop which encodes the special chars\r\n                        const url = new URL(lArticle.coverImage.url)\r\n                        lArticle.coverImage.url = url.href;\r\n\r\n                        lArticle.coverImage.url_1200  = lArticle.coverImage.url.replace(/attachments\\.cbd\\.int\\//, '$&1200x600/')\r\n                    }\r\n                    this.article = lArticle;\r\n                    this.$emit('load', { ...this.article });   \r\n                }\r\n                else {\r\n                    this.$emit('load');\r\n                }\r\n\r\n                this.$auth.fetchUser().then(()=>{\r\n                    if(this.showEdit || this.showEdit == 'true' || this.hasOwnProperty(this.showEdit)){\r\n\r\n                        let roles = [...this.showEditRoles, 'oasisArticleEditor', 'Administrator']\r\n                        this.hasEditRights = this.$auth.hasScope(roles);\r\n                    }\r\n                })\r\n            }\r\n            catch(e){\r\n                console.error(e)\r\n            }\r\n            finally{\r\n                this.loading = false;\r\n            }\r\n        },\r\n        preProcessOEmbed() {\r\n\r\n            setTimeout(function(){\r\n\r\n                document.querySelectorAll( 'oembed[url]' ).forEach(async function(element) {\r\n                    var url = element.attributes.url.value;\r\n                    var params = {\r\n                        url : encodeURI(url),\r\n                    }\r\n\r\n                    const response = await axios.get('/api/v2020/oembed', {params:params});                    \r\n                    var embedHtml = '<div class=\"ck-media__wrapper\" style=\"width:100%\">' + response.data.html +'</div>'\r\n                    element.insertAdjacentHTML(\"afterend\", embedHtml);\r\n                    \r\n                });\r\n\r\n            }, 500)\r\n        }\r\n    },\r\n    filters:{\r\n        lstring\r\n    }\r\n}\r\n</script>\r\n    \r\n<style>\r\n\r\n    @import url('https://cdn.jsdelivr.net/npm/@scbd/ckeditor5-build-inline-full@35.0.0/build/content-style.css');\r\n\r\n</style>\r\n"],"names":["sitePrefixUrl","test","_window","window","location","hostname","_window2","_window3","defaultOptions","prefixUrl","timeout","token","Vue","_Vue__namespace$proto","prototype","$auth","strategy","get","ApiBase","constructor","options","_this","isFunction","tokenType","config","baseURL","http","loadAsyncHeaders","arguments","head","post","put","patch","delete","request","baseConfig","headers","Authorization","concat","axios","create","tryCastToApiError","error","response","data","code","stringifyUrlParam","value","Date","toISOString","Object","JSON","stringify","stringifyUrlParams","valueObj","returnObj","key","entries","isValid","mapObjectId","id","isObjectId","$oid","params","undefined","includes","ArticlesApi","getArticleGroup","groupKey","q","f","s","sk","l","c","fo","ag","length","Error","encodeURIComponent","then","res","catch","getArticles","getArticleById","getArticlesByTag","tag","query","tags","getArticleAdminTags","lstring","ltext","locale","Number","isInteger","sText","en","normalized","normalizeText","text","entry","ar","es","fr","ru","zh","script$2","name","props","type","Array","required","default","customTags","adminTags","target","String","computed","newArticleUrl","domain","replace","baseUrl","queryString","_this$tags","_this$customTags","_this$adminTags","push","map","join","encodeURI","href","_createElementVNode","class","_createElementBlock","createElementBlock","$options","$props","_renderSlot","_ctx","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","cssEscape","TypeError","string","index","codeUnit","result","firstCodeUnit","charCodeAt","toString","charAt","cssEscapeUrl","url","script","components","cbdAddNewArticle","cbdArticleCoverImage","hideCoverImage","Boolean","showEdit","showEditTarget","showEditRoles","article","returnUrl","hasEditRights","loading","created","mounted","loadArticle","methods","articleResult","queryArticles","_lArticle$coverImage","lArticle","preProcessOEmbed","coverImage","URL","url_1200","$emit","fetchUser","hasOwnProperty","roles","hasScope","e","console","setTimeout","document","querySelectorAll","forEach","element","attributes","embedHtml","html","insertAdjacentHTML","filters","_hoisted_1","style","_openBlock","_createVNode","_component_cbd_article_cover_image","$data","_component_cbd_add_new_article","_id","innerHTML","content","$locale","_hoisted_6","_hoisted_7","_hoisted_8"],"mappings":"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"}